# Airport Management System

## Описание проекта

**Airport Management System** - это консольное приложение для управления информацией об аэропортах, самолётах, воротах и их статусах. Система предоставляет полный функционал CRUD (Create, Read, Update, Delete) для работы с базой данных SQL Server через микро-ORM Dapper.
> 📄 [**Презентация**](https://docs.google.com/presentation/d/1VdjHejZraHL-8JeT8WGmFwiuKLvssXMwv-C6qmRhcTo/edit?usp=sharing)

> 📄 [**Документация проекта**](https://docs.google.com/document/d/1Gk4seRoUHTjwnR6rvstxbJr3celgYPDZKCYIHtKOLj4/edit?usp=sharing)

> 📄 [**Полная документация по юнит-тестам**](https://github.com/bonel1to/AirportManagementSystem/blob/main/UNIT_TESTS_DOCUMENTATION.md)

---

## Содержание

1. [Технологии](#-технологии)
2. [Функциональность](#-функциональность)
3. [Структура проекта](#-структура-проекта)
4. [Архитектура базы данных](#-архитектура-базы-данных)
5. [Установка и запуск](#-установка-и-запуск)
6. [Использование](#-использование)
7. [Юнит-тесты](#-юнит-тесты)
8. [Архитектура приложения](#-архитектура-приложения)
9. [Известные проблемы и решения](#-известные-проблемы-и-решения)

---

## Технологии

### Backend

- **C# .NET 9.0** - основной язык программирования
- **Dapper 2.1.66** - микро-ORM для работы с БД
- **Microsoft.Data.SqlClient 6.1.2** - провайдер для SQL Server

### Database

- **SQL Server Express** - система управления базами данных
- **T-SQL** - язык запросов

### Testing

- **xUnit 2.9.2** - фреймворк для юнит-тестирования
- **Moq 4.20.70** - библиотека для создания mock-объектов
- **Microsoft.NET.Test.Sdk 17.12.0** - SDK для тестирования

### Patterns & Practices

- **Repository Pattern** - паттерн для инкапсуляции логики доступа к данным
- **Dependency Injection** - для управления зависимостями
- **Async/Await** - асинхронное программирование

---

## Функциональность

### Управление аэропортами

- Просмотр списка всех аэропортов
- Отображение информации: код, название, город, страна

### Управление статусами

- Просмотр доступных статусов самолётов
- Статусы: Active, Inactive, Repair, In Flight, Boarding
- Цветовая индикация статусов

### Управление самолётами (CRUD)

- **Create** - добавление нового самолёта с полной информацией
- **Read** - просмотр списка самолётов в табличном формате
- **Update** - редактирование данных самолёта
- **Delete** - удаление самолёта из системы
- **Детальный просмотр** - подробная информация о выбранном самолёте
- **Изменение статуса** - обновление статуса самолёта
- **Назначение к воротам** - привязка самолёта к конкретным воротам

### Статистика

- Общее количество аэропортов, статусов и самолётов
- Распределение самолётов по авиакомпаниям
- Распределение самолётов по статусам
- Распределение самолётов по аэропортам

### UI/UX Features

- Красивая анимация загрузки при запуске
- Табличное отображение данных с использованием псевдографики
- Цветовое кодирование (разные цвета для разных статусов)
- Интерактивное меню с навигацией
- Валидация пользовательского ввода

---

## Структура проекта

```
AirportTestApp/
├── Models/                          # Модели данных (POCO)
│   ├── Airplane.cs                  # Модель самолёта
│   ├── Airport.cs                   # Модель аэропорта
│   ├── Gate.cs                      # Модель ворот
│   └── Status.cs                    # Модель статуса
│
├── Services/                        # Сервисы
│   └── DatabaseService.cs           # Сервис для работы с БД через Dapper
│
├── Repositories/                    # Репозитории (паттерн Repository)
│   ├── AirplaneRepository.cs        # Репозиторий самолётов
│   ├── AirportRepository.cs         # Репозиторий аэропортов
│   ├── GateRepository.cs            # Репозиторий ворот
│   └── StatusRepository.cs          # Репозиторий статусов
│
├── Tests/                           # Юнит-тесты (6 тестов)
│   └── AirplaneRepositoryTests.cs   # Тесты для AirplaneRepository
│
├── Program.cs                       # Главный файл приложения
├── AirportTestApp.csproj            # Файл проекта
├── README.md                        # Документация (этот файл)
└── UNIT_TESTS_DOCUMENTATION.md      # 📄 Документация по юнит-тестам ⭐
```

---

## Архитектура базы данных

### Таблицы

#### 1. Airport (Аэропорты)

| Поле    | Тип        | Описание                                |
| ----------- | ------------- | ----------------------------------------------- |
| AirportID   | INT (PK)      | Уникальный идентификатор |
| AirportCode | NVARCHAR(10)  | Код аэропорта (IATA)                |
| AirportName | NVARCHAR(200) | Название аэропорта             |
| City        | NVARCHAR(100) | Город                                      |
| Country     | NVARCHAR(100) | Страна                                    |
| CreatedDate | DATETIME      | Дата создания записи          |
| IsActive    | BIT           | Активен ли аэропорт            |

#### 2. Gate (Ворота)

| Поле      | Тип       | Описание                                |
| ------------- | ------------ | ----------------------------------------------- |
| GateID        | INT (PK)     | Уникальный идентификатор |
| GateName      | NVARCHAR(50) | Название ворот                     |
| AirportID     | INT (FK)     | ID аэропорта                           |
| GateType      | NVARCHAR(50) | Тип ворот                               |
| Capacity      | INT          | Вместимость                          |
| IsOperational | BIT          | Работоспособность              |
| CreatedDate   | DATETIME     | Дата создания записи          |

#### 3. Status (Статусы)

| Поле          | Тип        | Описание                                |
| ----------------- | ------------- | ----------------------------------------------- |
| StatusID          | INT (PK)      | Уникальный идентификатор |
| StatusName        | NVARCHAR(50)  | Название статуса                 |
| StatusDescription | NVARCHAR(200) | Описание статуса                 |
| IsActive          | BIT           | Активен ли статус                |
| CreatedDate       | DATETIME      | Дата создания записи          |

**Предопределённые статусы:**

1. **Active** - Самолёт активен и готов к полётам
2. **Inactive** - Самолёт неактивен и не используется
3. **Repair** - Самолёт находится на ремонте
4. **In Flight** - Самолёт находится в полёте
5. **Boarding** - Происходит посадка пассажиров

#### 4. Airplane (Самолёты)

| Поле            | Тип        | Описание                                |
| ------------------- | ------------- | ----------------------------------------------- |
| AirplaneID          | INT (PK)      | Уникальный идентификатор |
| Model               | NVARCHAR(100) | Модель самолёта                   |
| Capacity            | INT           | Вместимость (пассажиры)     |
| Airline             | NVARCHAR(100) | Авиакомпания                        |
| StatusID            | INT (FK)      | ID статуса                               |
| GateID              | INT (FK)      | ID ворот (nullable)                        |
| RegistrationNumber  | NVARCHAR(50)  | Регистрационный номер       |
| ManufactureDate     | DATE          | Дата производства               |
| LastMaintenanceDate | DATE          | Последнее обслуживание     |
| NextMaintenanceDate | DATE          | Следующее обслуживание     |
| CreatedDate         | DATETIME      | Дата создания записи          |

---

## Установка и запуск

### Предварительные требования

1. **Visual Studio 2022** или **VS Code** с C# расширением
2. **SQL Server Express** (или полная версия)
3. **.NET 9.0 SDK**
4. **SQL Server Management Studio (SSMS)** - опционально

### Шаг 1: Клонирование проекта

```bash
git clone <repository-url>
cd AirportTestApp
```

### Шаг 2: Настройка базы данных

1. Откройте **SQL Server Management Studio**
2. Подключитесь к серверу: `<IP>\SQLEXPRESS` (например, `192.168.9.203\sqlexpress`)
3. Создайте базу данных:

```sql
CREATE DATABASE AirportManagementDB;
GO

USE AirportManagementDB;
GO
```

4. Выполните SQL-скрипты для создания таблиц (см. файл `Database_Schema.sql`)

### Шаг 3: Настройка подключения

Откройте файл `Program.cs` и измените строку подключения:

```csharp
string connectionString = "Server=YOUR_SERVER\\sqlexpress;Database=AirportManagementDB;User Id=YOUR_USER;Password=YOUR_PASSWORD;TrustServerCertificate=true;";
```

### Шаг 4: Восстановление пакетов

```bash
dotnet restore
```

### Шаг 5: Сборка проекта

```bash
dotnet build
```

### Шаг 6: Запуск приложения

```bash
dotnet run
```

Или в Visual Studio: нажмите `F5`

---

## Использование

### Главное меню

После запуска приложения вы увидите анимацию загрузки, а затем главное меню:

```
Система управления аэропортом
=====================================
Выберите действие:
1. Просмотреть аэропорты
2. Просмотреть статусы самолетов
3. Просмотреть самолеты
4. Добавить новый самолет
5. Редактировать самолет
6. Изменить статус самолета
7. Назначить самолет к воротам
8. Удалить самолет
9. Статистика
0. Выход
=====================================
```

### Примеры использования

#### 1. Просмотр самолётов (пункт 3)

Отображается таблица с основной информацией:

```
┌────┬──────────────────┬──────────────────┬──────────────┬──────┬──────────────┬────────────┬──────────────────────────┐
│ ID │ Модель           │ Авиакомпания     │ Рег. номер   │ Вмест│ Статус       │ Ворота     │ Аэропорт                 │
├────┼──────────────────┼──────────────────┼──────────────┼──────┼──────────────┼────────────┼──────────────────────────┤
│ 1  │ Boeing 737-800   │ Aeroflot         │ RA-73001     │  189 │ Active       │ A1         │ SVO                      │
│ 2  │ Airbus A320      │ S7 Airlines      │ VQ-BRE       │  180 │ In flight    │ B2         │ DME                      │
└────┴──────────────────┴──────────────────┴──────────────┴──────┴──────────────┴────────────┴──────────────────────────┘
```

**Цветовая индикация:**

- 🟢 Зелёный - Active
- 🔵 Голубой - In Flight
- 🟡 Жёлтый - Boarding
- 🔴 Красный - Repair
- ⚫ Серый - Inactive

#### 2. Добавление самолёта (пункт 4)

Пошаговая форма ввода данных:

```
➕ ДОБАВЛЕНИЕ НОВОГО САМОЛЕТА
================================

ДОСТУПНЫЕ СТАТУСЫ:
   1. Active - Самолет активен и готов к полетам
   2. inactive - Самолет неактивен и не используется
   3. repair - Самолет находится на ремонте
   4. in flight - Самолет находится в полете
   5. Boarding - Происходит посадка пассажиров

ДОСТУПНЫЕ ВОРОТА:
   1. A1 (Domestic) - Шереметьево
   2. A2 (International) - Шереметьево
   ...

Введите модель самолета: Boeing 777-300ER
Введите авиакомпанию: Emirates
Введите регистрационный номер: A6-EMW
Введите вместимость (пассажиры): 354
Введите ID статуса (1-5): 1
Введите ID ворот (или оставьте пустым): 3
...
```

#### 3. Детальный просмотр

После просмотра списка можно ввести ID для детального просмотра:

```
╔════════════════════════════════════════════════════════════════════════════╗
║                      📋 ПОДРОБНАЯ ИНФОРМАЦИЯ О САМОЛЁТЕ                    ║
╚════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────┬──────────────────────────────────────────────┐
│ Параметр                    │ Значение                                     │
├─────────────────────────────┼──────────────────────────────────────────────┤
│ ID самолёта                 │ 1                                            │
│ Модель                      │ Boeing 737-800                               │
│ Авиакомпания                │ Aeroflot                                     │
│ Регистрационный номер       │ RA-73001                                     │
│ Вместимость                 │ 189 пассажиров                               │
│ Статус                      │ Active - Самолет активен и готов к полетам   │
│ Ворота                      │ A1                                           │
│ Тип ворот                   │ Domestic                                     │
│ Аэропорт                    │ SVO - Шереметьево                            │
│ Город                       │ Москва, Россия                               │
│ Дата производства           │ 15.05.2020                                   │
│ Последнее обслуживание      │ 01.09.2024                                   │
│ Следующее обслуживание      │ 01.03.2025                                   │
│ Дата создания записи        │ 09.10.2025 10:30:45                          │
└─────────────────────────────┴──────────────────────────────────────────────┘
```

---

## Юнит-тесты

### Общая информация

Проект содержит **6 юнит-тестов** для проверки функциональности `AirplaneRepository`.

### Статистика тестов

| Показатель | Значение |
|------------|----------|
| **Всего тестов** | 6 |
| **Успешно пройдено** | ✅ 6 |
| **Провалено** | ❌ 0 |
| **Время выполнения** | 0.96 сек |

### Краткое описание тестов

#### ✅ Позитивные тесты (успешные сценарии)

1. **CreateAirplane_WithValidData_ReturnsSuccessfulId** - успешное добавление самолёта
2. **Airplane_Properties_WithValidData_AreSetCorrectly** - корректность свойств объекта
3. **UpdateAirplaneStatus_WithValidData_ReturnsTrue** - успешное обновление статуса

#### ❌ Негативные тесты (обработка ошибок)

4. **CreateAirplane_WithInvalidData_ThrowsException** - отклонение некорректных данных
5. **Airplane_Properties_WithInvalidData_FailsValidation** - выявление ошибок валидации
6. **UpdateAirplaneStatus_WithNonExistentId_ReturnsFalse** - обработка несуществующего ID

### Запуск тестов

#### Через Visual Studio:

1. Меню: **Test → Run All Tests**
2. Откроется **Test Explorer** с результатами

#### Через командную строку:

```bash
cd AirportTestApp
dotnet test --logger "console;verbosity=detailed"
```

**Результат:**

```
Всего тестов: 6
     Пройдено: 6
 Общее время: 0,9624 Секунды
```

### Используемые технологии

- **xUnit 2.9.2** - фреймворк для написания и выполнения тестов
- **Moq 4.20.70** - библиотека для создания mock-объектов
- **Microsoft.NET.Test.Sdk 17.12.0** - SDK для тестирования
- **AAA Pattern** - Arrange, Act, Assert (структура тестов)


---

## Архитектура приложения

### Паттерны проектирования

#### 1. Repository Pattern

Изолирует логику доступа к данным от бизнес-логики.

**Пример:**

```csharp
public class AirplaneRepository
{
    private readonly DatabaseService _databaseService;
  
    public async Task<IEnumerable<Airplane>> GetAllAirplanesAsync()
    {
        // SQL запрос и маппинг данных
    }
}
```

#### 2. Dependency Injection

Управление зависимостями через конструкторы.

**Пример:**

```csharp
var databaseService = new DatabaseService(connectionString);
var airplaneRepository = new AirplaneRepository(databaseService);
```

#### 3. Async/Await Pattern

Асинхронное выполнение операций с БД.

**Пример:**

```csharp
public async Task<Airplane> GetAirplaneByIdAsync(int airplaneId)
{
    string sql = "SELECT * FROM Airplane WHERE AirplaneID = @AirplaneId";
    return await _databaseService.QueryFirstOrDefaultAsync<Airplane>(sql, new { AirplaneId = airplaneId });
}
```

### Слои приложения

1. **Presentation Layer** - `Program.cs` (Консольный интерфейс, пользовательский ввод)
2. **Business Logic Layer** - `Repositories/` (Репозитории, валидация)
3. **Data Access Layer** - `Services/DatabaseService.cs` (Dapper, SQL запросы)
4. **Database Layer** - SQL Server (Таблицы, данные)

---

## Известные проблемы и решения

### Проблема 1: Ошибка подключения к SQL Server

**Симптомы:**

```
Не удалось подключиться к базе данных!
```

**Решение:**

1. Проверьте, что SQL Server запущен
2. Проверьте строку подключения
3. Убедитесь, что включена SQL Server Authentication
4. Проверьте настройки файрвола

### Проблема 2: Ошибка при снятии самолёта с ворот (ID = 0)

**Симптомы:**
Самолёт не снимается с ворот при вводе 0

**Решение:**
Исправлено в версии 1.1. Код корректно обрабатывает `null` значения для `GateID`.

### Проблема 3: Кодировка в консоли

**Симптомы:**
Кириллица отображается некорректно

**Решение:**

```csharp
Console.OutputEncoding = System.Text.Encoding.UTF8;
```

---

**Версия документации:** 1.0
**Последнее обновление:** 15 октября 2025
